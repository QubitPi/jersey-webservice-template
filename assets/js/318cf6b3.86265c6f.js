"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6913],{8474:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>u});var i=t(4848),a=t(8453),r=t(1470),s=t(9365);const o={sidebar_position:2,title:"Elide Standalone"},l=void 0,c={id:"crud/elide/elide-standalone",title:"Elide Standalone",description:"Overview",source:"@site/docs/crud/elide/elide-standalone.mdx",sourceDirName:"crud/elide",slug:"/crud/elide/elide-standalone",permalink:"/jersey-webservice-template/docs/crud/elide/elide-standalone",draft:!1,unlisted:!1,editUrl:"https://github.com/QubitPi/jersey-webservice-template/tree/master/docs/docs/crud/elide/elide-standalone.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Elide Standalone"},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/jersey-webservice-template/docs/crud/elide/intro"},next:{title:"Features",permalink:"/jersey-webservice-template/docs/crud/elide/features"}},d={},u=[{value:"Overview",id:"overview",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Spinning up the API",id:"spinning-up-the-api",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The Elide standalone application is a configurable web server using Elide. While Elide is typically a pluggable\n",(0,i.jsx)(n.strong,{children:"middleware"})," framework, we have constructed a flexible and complete service to allow our users to get started quickly."]}),"\n",(0,i.jsx)(n.p,{children:"The Elide standalone application takes an opinionated stance on its technology stack (i.e. jersey/jetty), but provides\nmany opportunities for users to configure the behavior of their application. To use the Elide standalone application,\nthere are only a few steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Configure ElideStandalone by implementing a BinderFactory & ResourceConfig."}),"\n",(0,i.jsxs)(n.li,{children:["Build an uber jar containing ",(0,i.jsx)(n.code,{children:"elide-standalone"}),", our models, security checks, and additional application\nconfigurations."]}),"\n",(0,i.jsx)(n.li,{children:"Start your web service as WAR"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(n.p,{children:"Elide models are some of the most important code in any Elide project. Our models are the view of our data that we\nwish to expose. In this example we will be modeling a software artifact repository since most developers have a\nhigh-level familiarity with artifact repositories such as Maven, Artifactory, npm, and the like."}),"\n",(0,i.jsx)(n.p,{children:"There will 2 kinds of models:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Models that we intend to both read & write"}),". These models are created by defining Java classes.  For this\nexample, that includes ",(0,i.jsx)(n.code,{children:"ArtifactGroup"}),", ",(0,i.jsx)(n.code,{children:"ArtifactProduct"}),", and ",(0,i.jsx)(n.code,{children:"ArtifactVersion"}),".  For brevity we will omit package\nnames and import statements."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Read-only models"})," that we intend to run analytic queries against. These models can be created with Java classes\nor with a HJSON configuration language.  For this example, we will use the latter to create a ",(0,i.jsx)(n.code,{children:"Downloads"})," model."]}),"\n"]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(s.A,{value:"ArtifactGroup.java",label:"ArtifactGroup.java",default:!0,children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Include(rootLevel = true, name = "group")\n@Entity\npublic class ArtifactGroup {\n    @Id\n    private String name = "";\n\n    private String commonName = "";\n\n    private String description = "";\n\n    @OneToMany(mappedBy = "group")\n    private List<ArtifactProduct> products = new ArrayList<>();\n}\n'})})}),(0,i.jsx)(s.A,{value:"ArtifactProduct.java",label:"ArtifactProduct.java",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Include(name = "product")\n@Entity\npublic class ArtifactProduct {\n    @Id\n    private String name = "";\n\n    private String commonName = "";\n\n    private String description = "";\n\n    @ManyToOne\n    private ArtifactGroup group = null;\n\n    @OneToMany(mappedBy = "artifact")\n    private List<ArtifactVersion> versions = new ArrayList<>();\n}\n'})})}),(0,i.jsx)(s.A,{value:"ArtifactVersion.java",label:"ArtifactVersion.java",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Include(name = "version")\n@Entity\npublic class ArtifactVersion {\n    @Id\n    private String name = "";\n\n    private Date createdAt = new Date();\n\n    @ManyToOne\n    private ArtifactProduct artifact;\n}\n'})})}),(0,i.jsx)(s.A,{value:"artifactDownloads.hjson",label:"artifactDownloads.hjson",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hjson",children:"{\n  tables: [\n    {\n      name: Downloads\n      table: downloads\n      description:\n      '''\n      Analytics for artifact downloads.\n      '''\n      joins: [\n        {\n          name: artifactGroup\n          to: group\n          kind: toOne\n          type: left\n          definition: '{{group_id}} = {{artifactGroup.name}}'\n        },\n        {\n          name: artifactProduct\n          to: product\n          kind: toOne\n          definition: '{{product_id}} = {{artifactProduct.name}}'\n        }\n      ]\n      dimensions: [\n        {\n          name: group\n          type: TEXT\n          definition: '{{artifactGroup.name}}'\n        }\n        {\n          name: product\n          type: TEXT\n          definition: '{{artifactProduct.name}}'\n        }\n        {\n          name: date\n          type: TIME\n          definition: '{{date}}'\n          grains: [{\n            type: DAY\n          }]\n        }\n      ]\n      measures: [\n        {\n          name: downloads\n          type: INTEGER\n          definition: 'SUM({{downloads}})'\n        }\n      ]\n    }\n  ]\n}\n"})})})]}),"\n",(0,i.jsx)(n.h2,{id:"spinning-up-the-api",children:"Spinning up the API"}),"\n",(0,i.jsxs)(n.p,{children:["Running Elide standalone is pretty straight forward by essentially implementing a ",(0,i.jsx)(n.strong,{children:"Binder"})," and a ",(0,i.jsx)(n.strong,{children:"ResourceConfig"}),":"]}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"hibernate.hbm2ddl.auto"})," in this example is set to ",(0,i.jsx)(n.code,{children:"create"}),", which means each run of the standalone will erase the\ndatabase and re-create tables. Please do change this value if used in production"]})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/QubitPi/jersey-webservice-template/pull/29/files",children:"In order for dependency injection to work properly in Elide standalone"}),",\nwe must use ",(0,i.jsx)(n.a,{href:"https://eclipse-ee4j.github.io/jersey.github.io/documentation/latest/ioc.html#d0e17933",children:"Jersey binder"}),",\nnot ",(0,i.jsx)(n.a,{href:"https://javaee.github.io/hk2/",children:"HK binder"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'\nimport org.glassfish.jersey.internal.inject.AbstractBinder;\nimport org.glassfish.jersey.internal.inject.Binder;\n\n/**\n * A binder factory builds a custom binder for the Jersey application.\n * <p>\n * The factory makes the component object instance that will eventually be passed to\n * {@link org.glassfish.jersey.server.ResourceConfig#register(Object)}.\n */\n@Immutable\n@ThreadSafe\npublic class BinderFactory {\n\n    /**\n     * Builds a hk2 Binder instance.\n     * <p>\n     * This binder should bind all relevant resources for runtime dependency injection.\n     *\n     * @param injector  A standard HK2 service locator\n     *\n     * @return a binder instance that will be registered by putting as a parameter to\n     * {@link org.glassfish.jersey.server.ResourceConfig#register(Object)}\n     */\n    @NotNull\n    public Binder buildBinder(final ServiceLocator injector) {\n        return new AbstractBinder() {\n\n            private static final Consumer<EntityManager> TXCANCEL = em -> em.unwrap(Session.class).cancelQuery();\n\n            private final ClassScanner classScanner = new DefaultClassScanner();\n\n            @Override\n            protected void configure() {\n                final ElideSettings elideSettings = buildElideSettings();\n\n                bind(buildElide(elideSettings)).to(Elide.class).named("elide");\n                bind(elideSettings).to(ElideSettings.class);\n                bind(elideSettings.getDictionary()).to(EntityDictionary.class);\n                bind(elideSettings.getDataStore()).to(DataStore.class).named("elideDataStore");\n            }\n\n            /**\n             * Initializes Elide middleware service.\n             *\n             * @param elideSettings  An object for configuring various aspect of the Elide middleware\n             *\n             * @return a new instance\n             */\n            @NotNull\n            private Elide buildElide(@NotNull final ElideSettings elideSettings) {\n                return new Elide(\n                        elideSettings,\n                        new TransactionRegistry(),\n                        elideSettings.getDictionary().getScanner(),\n                        false\n                );\n            }\n\n            /**\n             * Initializes Elide config object.\n             *\n             * @return a new instance\n             */\n            @NotNull\n            private ElideSettings buildElideSettings() {\n                return new ElideSettingsBuilder(buildDataStore(buildEntityManagerFactory()))\n                        .withEntityDictionary(buildEntityDictionary(injector))\n                        .build();\n            }\n\n            /**\n             * Initializes the Elide {@link DataStore} service with the specified {@link EntityManagerFactory}.\n             *\n             * @param entityManagerFactory  An object used to initialize JPA\n             *\n             * @return a new instance\n             */\n            @NotNull\n            private DataStore buildDataStore(@NotNull final EntityManagerFactory entityManagerFactory) {\n                return new JpaDataStore(\n                        entityManagerFactory::createEntityManager,\n                        em -> new NonJtaTransaction(em, TXCANCEL),\n                        entityManagerFactory::getMetamodel\n                );\n            }\n\n            /**\n             * Initializes the {@link EntityManagerFactory} service used by Elide JPA.\n             *\n             * @return a new instance\n             */\n            @NotNull\n            private EntityManagerFactory buildEntityManagerFactory() {\n                final String modelPackageName = "com.mycompany.mymodel";\n\n                final ClassLoader classLoader = null;\n\n                final PersistenceUnitInfo persistenceUnitInfo = new PersistenceUnitInfoImpl(\n                        "my-webservice",\n                        getAllEntities(classScanner, modelPackageName),\n                        getDefaultDbConfigs(),\n                        classLoader\n                );\n\n                return new EntityManagerFactoryBuilderImpl(\n                        new PersistenceUnitInfoDescriptor(persistenceUnitInfo),\n                        new HashMap<>(),\n                        classLoader\n                ).build();\n            }\n\n            /**\n             * Get all the entities in a package.\n             *\n             * @param scanner  An object that picks up entities by Elide annotation\n             * @param packageName  A fully qualified package name under which contains all entities\n             *\n             * @return all entities found in the provided package.\n             */\n            @NotNull\n            public static List<String> getAllEntities(\n                    @NotNull final ClassScanner scanner,\n                    @NotNull final String packageName\n            ) {\n                return scanner.getAnnotatedClasses(packageName, Entity.class).stream()\n                        .map(Class::getName)\n                        .collect(Collectors.toList());\n            }\n\n            /**\n             * Returns a collection of DB configurations, including connecting credentials.\n             * <p>\n             * In addition, the configurations consumes all configs defined in {@link JpaDatastoreConfig}\n             *\n             * @return a new instance\n             */\n            @NotNull\n            @SuppressWarnings("MultipleStringLiterals")\n            private static Properties getDefaultDbConfigs() {\n                final Properties dbProperties = new Properties();\n\n                dbProperties.put("hibernate.show_sql", "true");\n                dbProperties.put("hibernate.hbm2ddl.auto", "create");\n                dbProperties.put("hibernate.dialect", "org.hibernate.dialect.MySQLDialect");\n                dbProperties.put("hibernate.current_session_context_class", "thread");\n                dbProperties.put("hibernate.jdbc.use_scrollable_resultset", "true");\n\n                // Collection Proxy & JDBC Batching\n                dbProperties.put("hibernate.jdbc.batch_size", "50");\n                dbProperties.put("hibernate.jdbc.fetch_size", "50");\n                dbProperties.put("hibernate.default_batch_fetch_size", "100");\n\n                // Hikari Connection Pool Settings\n                dbProperties.putIfAbsent("hibernate.connection.provider_class",\n                        "com.zaxxer.hikari.hibernate.HikariConnectionProvider");\n                dbProperties.putIfAbsent("hibernate.hikari.connectionTimeout", "20000");\n                dbProperties.putIfAbsent("hibernate.hikari.maximumPoolSize", "30");\n                dbProperties.putIfAbsent("hibernate.hikari.idleTimeout", "30000");\n\n                dbProperties.put("jakarta.persistence.jdbc.driver", "com.mysql.cj.jdbc.Driver");\n                dbProperties.put("jakarta.persistence.jdbc.url", "jdbc:mysql://db/minerva?serverTimezone=UTC");\n                dbProperties.put("jakarta.persistence.jdbc.user", "root");\n                dbProperties.put("jakarta.persistence.jdbc.password", "root");\n\n                return dbProperties;\n            }\n\n            /**\n             * Initializes the Elide {@link EntityDictionary} service with a given dependency injector.\n             *\n             * @param injector  A standard HK2 service locator used by Elide\n             *\n             * @return a new instance\n             */\n            @NotNull\n            private EntityDictionary buildEntityDictionary(@NotNull final ServiceLocator injector) {\n                return new EntityDictionary(\n                        new HashMap<>(),\n                        new HashMap<>(),\n                        new Injector() {\n                            @Override\n                            public void inject(final Object entity) {\n                                injector.inject(entity);\n                            }\n\n                            @Override\n                            public <T> T instantiate(final Class<T> cls) {\n                                return injector.create(cls);\n                            }\n                        },\n                        CoerceUtil::lookup,\n                        new HashSet<>(),\n                        classScanner\n                );\n            }\n        };\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'/**\n * The resource configuration for the web applications.\n */\n@Immutable\n@ThreadSafe\n@ApplicationPath("/v1/data/")\npublic class ResourceConfig extends org.glassfish.jersey.server.ResourceConfig {\n\n    private static final String GRAPHQL_ENDPOINT_PACKAGE = "com.paiondata.elide.graphql";\n    private static final String JAON_API_ENDPOINT_PACKAGE = "com.paiondata.elide.jsonapi.resources";\n\n    /**\n     * DI Constructor.\n     *\n     * @param injector  A standard HK2 service locator\n     */\n    @Inject\n    public ResourceConfig(@NotNull final ServiceLocator injector) {\n        this(injector, new BinderFactory());\n    }\n\n    /**\n     * Constructor that allows for finer dependency injection control.\n     *\n     * @param injector  A standard HK2 service locator\n     * @param binderFactory  An object that produces resource binder\n     */\n    private ResourceConfig(@NotNull final ServiceLocator injector, @NotNull final BinderFactory binderFactory) {\n        packages(JAON_API_ENDPOINT_PACKAGE, GRAPHQL_ENDPOINT_PACKAGE);\n\n        register(binderFactory.buildBinder(injector));\n\n        // Bind api docs to given endpoint\n        // This looks strange, but Jersey binds its Abstract binders first, and then later it binds \'external\'\n        // binders (like this HK2 version). This allows breaking dependency injection into two phases.\n        // Everything bound in the first phase can be accessed in the second phase.\n        register(new org.glassfish.hk2.utilities.binding.AbstractBinder() {\n            @Override\n            protected void configure() {\n                injector.getService(Elide.class, "elide").doScans();\n            }\n        });\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>s});t(6540);var i=t(53);const a={tabItem:"tabItem_Ymn6"};var r=t(4848);function s(e){let{children:n,hidden:t,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.A)(a.tabItem,s),hidden:t,children:n})}},1470:(e,n,t)=>{t.d(n,{A:()=>x});var i=t(6540),a=t(53),r=t(3104),s=t(6347),o=t(205),l=t(7485),c=t(1682),d=t(9466);function u(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:i,default:a}}=e;return{value:n,label:t,attributes:i,default:a}}))}(t);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function h(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function b(e){let{queryString:n=!1,groupId:t}=e;const a=(0,s.W6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(r),(0,i.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})}),[r,a])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,r=p(e),[s,l]=(0,i.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const i=t.find((e=>e.default))??t[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:r}))),[c,u]=b({queryString:t,groupId:a}),[f,g]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,r]=(0,d.Dv)(t);return[a,(0,i.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:a}),m=(()=>{const e=c??f;return h({value:e,tabValues:r})?e:null})();(0,o.A)((()=>{m&&l(m)}),[m]);return{selectedValue:s,selectValue:(0,i.useCallback)((e=>{if(!h({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),g(e)}),[u,g,r]),tabValues:r}}var g=t(2303);const m={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=t(4848);function y(e){let{className:n,block:t,selectedValue:i,selectValue:s,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),a=o[t].value;a!==i&&(c(n),s(a))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:r}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>l.push(e),onKeyDown:u,onClick:d,...r,className:(0,a.A)("tabs__item",m.tabItem,r?.className,{"tabs__item--active":i===n}),children:t??n},n)}))})}function j(e){let{lazy:n,children:t,selectedValue:a}=e;const r=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=r.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function w(e){const n=f(e);return(0,v.jsxs)("div",{className:(0,a.A)("tabs-container",m.tabList),children:[(0,v.jsx)(y,{...e,...n}),(0,v.jsx)(j,{...e,...n})]})}function x(e){const n=(0,g.A)();return(0,v.jsx)(w,{...e,children:u(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(6540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);